---
title: "تحليل بيانات Bulk RNA-Seq باستخدام R"
lang: ar
output:
  html_document:
    css: ../sc/style.css
    df_print: paged
    toc: true
    toc_float: true
  pdf_document: default
editor_options:
  markdown:
    wrap: sentence
---

### ورشة عمل مقامة يوم 11 أكتوبر 2025 في مدينة أكسفورد
### نرحب بالتواصل معكم من خلال وسائل التواصل التالية:
### [YouTube](http://www.youtube.com/@Dalah-info) | [X](https://x.com/Dalah_Info) | [LinkedIn](https://www.linkedin.com/company/dalah/) | [GitHub](https://github.com/Dalah-Info)

---

# 🧬 مقدمة: ما هو تحليل الـ RNA-seq؟

## 📘 ما الذي نقيسه في تجربة RNA-seq؟

تحليل **RNA-seq** هو أحد أهم التقنيات في علم الجينوم الوظيفي،  
ويُستخدم لقياس **كمية التعبير الجيني** لكل جين في خلية أو نسيج.

في هذه التقنية، يتم:

1. استخلاص الـ RNA من العينات (مثل نسيج طبيعي أو نسيج ورمي).  
2. تحويله إلى cDNA وتسلسله.  
3. حساب عدد القراءات (Reads) التي تمثل كل جين في كل عينة.

> 💡 هذه العدّات هي البيانات الأساسية التي سنحللها اليوم.

---

## 🔬 الفرق بين Bulk RNA-seq وSingle-cell RNA-seq

| النوع | الهدف | التباين | ملاحظات |
|-------|--------|----------|----------|
| **Bulk RNA-seq** | قياس التعبير المتوسط لمجموعة خلايا (مثل نسيج كامل). | لا يُظهر تباين الخلايا المفردة. | يستخدم في المقارنات بين المجموعات (مثل طبيعي مقابل ورمي). |
| **Single-cell RNA-seq** | قياس التعبير لكل خلية على حدة. | يكشف التغاير داخل النسيج. | يتطلب تحليلًا أكثر تعقيدًا. |

> في هذه الورشة سنعمل على **Bulk RNA-seq** لأنها الأنسب لاكتشاف الجينات المختلفة بين الحالات.

---

## 🧠 كيف تُخزّن بيانات RNA-seq؟

عادةً نحصل على ملفين أساسيين:

1. **Count matrix (مصفوفة العدّات):**  
   - الصفوف = الجينات (Gene IDs)  
   - الأعمدة = العينات (Samples)  
   - القيم = عدد القراءات لكل جين في كل عينة  

2. **Metadata (أو Design file):**  
   - يحتوي على معلومات وصفية عن العينات (مثل نوع العينة، الحالة المرضية، مصدر النسيج...)  
   - يربط كل عينة باسمها الموجود في جدول العدّات  

> ✨ بدمج الملفين يمكننا معرفة أي قراءة تخص أي عينة وأي حالة مرضية.

---

## 🎯 الهدف من تحليل البيانات

هدفنا في هذه الورشة هو تحليل بيانات RNA-seq لمجموعة من عينات **سرطان القولون**،  
لدراسة الاختلاف في التعبير الجيني بين:

> **Primary tumor (الورم الأولي)** 🆚 **(نسيج طبيعي مجاور) Solid tissue normal**

وسنقوم بـ:

1️⃣ تنظيف البيانات وتصفية الجينات منخفضة التعبير.  
2️⃣ إجراء التحليل  باستخدام **DESeq2**.  
3️⃣ رسم المخططات التفسيرية (PCA, Volcano, Boxplot, Violin).  
4️⃣ تنفيذ تحليل  (GO وKEGG).  
5️⃣ وفي النهاية، سنطبق عمليًا على مقارنة أخرى.

---

## ⚙️ الخطوات العامة للتحليل

1️⃣ قراءة ملفات العدّات والبيانات الوصفية.  
2️⃣ تصفية الجينات منخفضة التعبير.  
3️⃣ تحليل الفروق بين المجموعات (**DESeq2**).  
4️⃣ تحويل البيانات (**VST**).  
5️⃣ رسم العينات والجينات  (**PCA** و**Volcano**).  
6️⃣ تحليل للوظائف والمسارات المتأثرة.

---

## 0. تهيئة بيئة العمل وتحميل الحزم البرمجية

> 🧭 **متطلب سابق للورشة:**  
> يرجى التأكد من تشغيل ملف  
> `install_packages_bulkRNAseq.R`  
> قبل بدء الورشة لتثبيت الحزم اللازمة. <br>
> ⚠️ ملاحظة: هذه الخطوة مهمة فقط إذا لم تكن الحزم مثبتة مسبقًا على جهازك.  
بعد التثبيت لمرة واحدة، يمكن تجاهلها والاكتفاء باستخدام `library()` لاحقًا.<br>
> 📺 لمشاهدة شرح تثبيت الحزم من CRAN / GitHub / Bioconductor:  
> [طريقة تثبيت الحزم في R](https://youtu.be/AQpDAl2yfLM?si=iGebpOznDkZOIlBS)

---

### 📦 الحزم المستخدمة وهدف كل منها

**`library(tidyverse)`**  
> تُحمِّل مجموعة من الحزم المتكاملة مثل `dplyr`, `ggplot2`, و `readr`  
> لتسهيل التعامل مع البيانات وتنظيفها وتحليلها.  
> 🔗 <https://www.tidyverse.org>

---

**`library(DESeq2)`**  
> الحزمة الأساسية لتحليل بيانات التعبير الجيني التفاضلي (RNA-seq).  
> تعتمد على نموذج **Negative Binomial** وتقدّم تطبيعًا وتحليلًا إحصائيًا دقيقًا.  
> 🔗 <https://bioconductor.org/packages/release/bioc/html/DESeq2.html>

---

**`library(apeglm)`**  
> تُستخدم لتطبيق تقنيات **Shrinkage** على قيم `log2FoldChange`  
> لتقليل التشتت وتحسين موثوقية النتائج في الجينات منخفضة التعبير.  
> 🔗 <https://bioconductor.org/packages/release/bioc/html/apeglm.html>

---

**`library(AnnotationDbi)` و `library(org.Hs.eg.db)`**  
> تُستخدمان لتحويل معرفات الجينات (مثل Ensembl IDs)  
> إلى أسماء جينات قابلة للقراءة أو معرفات Entrez لاستخدامها في تحليل الإثراء.  
> 🔗 <https://bioconductor.org/packages/release/bioc/html/AnnotationDbi.html>

---

**`library(clusterProfiler)`**  
> حزمة قوية لتحليل الإثراء الوظيفي (Functional Enrichment)  
> سواء لـ **GO** أو **KEGG Pathways**.  
> 🔗 <https://bioconductor.org/packages/release/bioc/html/clusterProfiler.html>

---

**`library(ggplot2)` و `library(ggrepel)`**  
> لإنشاء رسوم بيانية تفاعلية وعلمية مثل Volcano plot و PCA و Boxplot.  
> 🔗 <https://ggplot2.tidyverse.org>

---

**`library(pheatmap)` و `library(RColorBrewer)`**  
> لإنشاء خرائط حرارية (Heatmaps) غنية بالألوان لتوضيح أنماط التعبير الجيني.  
> 🔗 <https://cran.r-project.org/web/packages/pheatmap/>

---

### ⚙️ تفعيل الحزم

```{r error=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)       
library(DESeq2)          
library(apeglm)          
library(AnnotationDbi)   
library(org.Hs.eg.db)    
library(clusterProfiler) 
library(ggplot2)         
library(ggrepel)         
library(pheatmap)        
library(RColorBrewer)
library(ReactomePA)
```
# 1️⃣ قراءة البيانات

## 1.1 تحميل ملفات **counts** و **metadata**

الملفان المستخدمان مأخوذان من تجربة عامة **E-GEOD-50760**،  
وهي بيانات عامة لتجارب **RNA-seq** تُستخدم كثيرًا لأغراض التدريب والتعليم.

| الملف | المحتوى | الرابط |
|--------|----------|---------|
| **counts** | عدد القراءات لكل جين في كل عينة | [رابط التحميل](http://genomedata.org/gen-viz-workshop/intro_to_deseq2/tutorial/E-GEOD-50760-raw-counts.tsv) |
| **metadata** | وصف العينات والحالة المرضية | [رابط التحميل](http://genomedata.org/gen-viz-workshop/intro_to_deseq2/tutorial/E-GEOD-50760-experiment-design.tsv) |

---

```{r}
#  تحميل بيانات الـ RNA-seq

#  تحديد روابط ملفات العدّات (counts) وملف البيانات الوصفية (metadata)
counts_url <- "http://genomedata.org/gen-viz-workshop/intro_to_deseq2/tutorial/E-GEOD-50760-raw-counts.tsv"
design_url <- "http://genomedata.org/gen-viz-workshop/intro_to_deseq2/tutorial/E-GEOD-50760-experiment-design.tsv"

# الخطوة 2: قراءة الملفات من الإنترنت مباشرة باستخدام دالة read_tsv من مكتبة readr
# تُقرأ البيانات إلى إطار بيانات (Data Frame) داخل R
counts <- readr::read_tsv(counts_url)    # ملف العدّات الجينية
metadata <- readr::read_tsv(design_url)    # ملف البيانات الوصفية
```
## 1.2 استعراض البيانات وفهم مكوناتها

### 💡 ما الذي يحتويه كل ملف؟

قبل البدء في التحليل، من المهم أن نفهم **محتوى كل ملف** وما تمثّله الأعمدة بداخله.

---

### 🧾 ملف العدّات (**counts**)

| العمود | الشرح |
|--------|--------|
| **gene_id** | معرف الجين (عادةً يكون بصيغة Ensembl ID مثل: ENSG00000141510). |
| **بقية الأعمدة** | أسماء العينات، بحيث يمثل كل عمود عينة واحدة تحتوي على عدد القراءات الخاصة بها. |

---

### 📋 ملف البيانات الوصفية (**metadata**)

| العمود | الشرح |
|--------|--------|
| **Run** | اسم أو رمز العينة (يتوافق مع أسماء الأعمدة في ملف counts). |
| **Sample Characteristic[disease]** | يصف نوع المرض المرتبط بالعينة (مثل: Colorectal Cancer). |
| **Sample Characteristic[biopsy site]** | موقع أخذ العينة (مثل: Primary tumor أو Solid tissue normal). |
| **Sample Characteristic[disease staging]** | مرحلة المرض أو درجة الورم (مثل: Stage IV). |
| **Sample Characteristic[organism]** | نوع الكائن الحي (عادةً Homo sapiens). |
| **Factor Value[biopsy site]** | المتغير التجريبي الرئيسي الذي سنستخدمه لاحقًا للمقارنة بين المجموعات. |

---

### 📊 استعراض البيانات في R

الآن سنستعرض شكل الملفات بعد قراءتها داخل R للتأكد من أن البيانات قُرئت بشكل صحيح،  
ولفهم أسماء الأعمدة وعدد العينات في كل ملف.

```{r}
#  استعراض شكل بيانات العدّات (counts)
head(counts)

#  استعراض شكل بيانات الملف الوصفي (metadata)
head(metadata)
```
## 1.3 تجهيز ملفات metadata و counts لتسهيل التعامل

بعد تحميل الملفات، نحتاج لتبسيطها وتجهيزها حتى تكون جاهزة للتحليل باستخدام DESeq2.

---

### 🧩 الخطوة 1: تجهيز ملف metadata

ملف `metadata` يحتوي على العديد من الأعمدة غير الضرورية.  
سنقوم باختيار الأعمدة المهمة فقط، وإعادة تسميتها، وتبسيط القيم لتصبح مختصرة وسهلة الاستخدام.

```{r}
# جعل العمود Run هو اسم الصف (index)
metadata <- metadata %>%
  column_to_rownames(var = "Run") %>%
  select(`Sample Characteristic[biopsy site]`, `Sample Characteristic[individual]`)

colnames(metadata) <- c("tissueType", "individualID")

metadata$tissueType <- metadata$tissueType %>%
  str_replace("colorectal cancer metastatic in the liver", "liver_meta") %>%
  str_replace("primary tumor", "primary_tumor") %>%
  str_replace("solid tissue normal", "normal") %>%
  as.factor()

head(metadata)
```
### 💡 لماذا هذه الخطوة مهمة؟

- تبسيط الأسماء يجعل المقارنة أسهل (خاصة في `contrast` داخل **DESeq2**).  
- إزالة المسافات تمنع الأخطاء عند كتابة أسماء الحالات داخل الأوامر.  
- تسمية الأعمدة بشكل واضح (`tissueType`, `individualID`) تساعد في الفهم والقراءة.

---

##  🧩 الخطوة 2: تجهيز ملف العدّات (counts)

ملف العدّات يحتوي على أسماء الجينات في عمودين:  
**"Gene ID"** و **"Gene Name"**  
وتحتاج مكتبة **DESeq2** إلى أن تكون **أسماء الجينات هي أسماء الصفوف (rownames)**،  
لذلك سنعيد هيكلة الملف بهذا الشكل.

```{r}
gene_ids <- counts$`Gene ID`
gene_names <- counts[, c("Gene ID", "Gene Name")]

count_mat <- counts %>%
  select(-c(`Gene ID`, `Gene Name`)) %>%
  mutate_all(~ as.numeric(str_trim(.))) %>%
  as.matrix()

rownames(count_mat) <- gene_ids

head(count_mat)
```

## 1.4 مطابقة العينات بين ملفات **counts** و **metadata**

بعد أن استعرضنا شكل البيانات،  
ننتقل الآن إلى خطوة مهمة جدًا وهي **مطابقة العينات بين الملفين**.

---

### 🎯 الهدف من هذه الخطوة

نحتاج إلى التأكد من أن أسماء العينات في **metadata** تطابق تمامًا أسماء الأعمدة في ملف **counts**،  
لأن أي اختلاف أو ترتيب غير متناسق سيؤدي إلى **تحليل خاطئ** في الخطوات اللاحقة.  

> 💡 الفكرة:  
> كل صف في `metadata` يجب أن يقابل عمودًا في `counts` يمثل نفس العينة.

---

### ⚙️ الخطوات البرمجية

```{r}
rownames(metadata) <- str_trim(rownames(metadata))
colnames(count_mat) <- str_trim(colnames(count_mat))

metadata <- metadata[match(colnames(count_mat), rownames(metadata)), ]

all(rownames(metadata) == colnames(count_mat))

```

### 📘 ما أهمية هذا الترتيب؟

لأن خوارزمية **DESeq2** تفترض أن **الترتيب في ملف metadata يطابق تمامًا ترتيب الأعمدة في ملف العدّات (counts)**.  
أي اختلاف في الترتيب سيؤدي إلى ربط غير صحيح بين القراءات والعينات،  
مما يسبب **تحليلًا إحصائيًا خاطئًا** ونتائج غير موثوقة.

---

### ✨ ملخص المرحلة السابقة

✅ قرأنا البيانات بنجاح.  
✅ فهمنا مكونات كل ملف.  
✅ ربطنا العينات وتأكدنا من ترتيبها الصحيح.

> أصبحنا الآن جاهزين للبدء في التحليل الإحصائي باستخدام **DESeq2**.

---

# 2. تصفية الجينات منخفضة التعبير

### 💡 الهدف من هذه الخطوة

في بيانات **RNA-seq**، توجد جينات ذات مستويات تعبير منخفضة جدًا  
(قد تكون ناتجة عن ضجيج تجريبي أو قراءة عشوائية).  
هذه الجينات لا تضيف معلومات مفيدة وغالبًا ما تُضعف دقة التحليل الإحصائي.  

لذلك نقوم بتصفية الجينات ذات القراءات المنخفضة قبل تطبيق نموذج **DESeq2**.

---

### 🔍 كيف نقرر أي الجينات نحذف؟

نحسب مجموع القراءات لكل جين عبر جميع العينات،  
ثم نحذف الجينات التي يكون مجموعها أقل من قيمة معينة (مثل **10** أو **20**).  
القيمة ليست ثابتة، ولكن الهدف هو الاحتفاظ فقط بالجينات ذات الإشارة الحقيقية.

---

## 2.1 معالجة ملف العدّات (counts) قبل التصفية

أولًا، سنقوم بتهيئة البيانات بشكل صحيح لضمان أن مصفوفة العدّات تحتوي فقط على القيم الرقمية لكل عينة،  
وأن أسماء الصفوف تمثل الجينات (Gene IDs).

---

```{r}
# تحديد اسم عمود معرف الجين (عادة يكون العمود الأول)
gene_col <- colnames(counts)[1]

# استخراج أسماء الجينات من العمود الأول
gene_ids <- counts[[gene_col]]

# إزالة العمودين "Gene ID" و"Gene Name" من البيانات
count_data <- counts[, !(colnames(counts) %in% c(gene_col, "Gene Name"))]

# تحويل القيم إلى أرقام بعد إزالة المسافات البيضاء
count_data[] <- lapply(count_data, function(x) as.numeric(str_trim(x)))

# تحويل الإطار إلى مصفوفة رقمية
count_mat <- as.matrix(count_data)

# تعيين أسماء الجينات كأسماء صفوف
rownames(count_mat) <- gene_ids

# التحقق من شكل البيانات بعد التحويل
head(count_mat[, 1:5])

```
---

## 2.2 حساب مجموع القراءات وتصفية الجينات

الآن بعد أن أصبحت البيانات رقمية ونظيفة، نحسب مجموع القراءات لكل جين عبر جميع العينات
ثم نحذف الجينات التي مجموعها أقل من قيمة محددة (مثل 10 أو 20).

---
```{r}
# حساب مجموع القراءات لكل جين عبر جميع العينات
gene_sums <- rowSums(count_mat, na.rm = TRUE)

# الاحتفاظ فقط بالجينات التي مجموع قراءاتها ≥ 10
keep <- gene_sums >= 10
count_mat <- count_mat[keep, ]

#لرؤية تأثير التصفية وعدد الجينات قبل وبعد العملية
cat("عدد الجينات قبل التصفية:", length(gene_sums), "\n")
cat("عدد الجينات بعد التصفية:", sum(keep), "\n")
```

## 3. إنشاء كائن التحليل الرئيسي باستخدام DESeq2

### 💡 ما الهدف من هذه الخطوة؟

بعد أن أصبحت بيانات العدّات جاهزة ومصفوفة بشكل صحيح،  
نحتاج الآن إلى إنشاء كائن تحليلي من مكتبة **DESeq2** يجمع بين:

- بيانات العدّات (**count_mat**)  
- البيانات الوصفية (**metadata**)  
- المعادلة التجريبية التي تحدد المقارنة (**design formula**)  

هذا الكائن يُعد الخطوة الأساسية التي ستُستخدم لاحقًا في جميع مراحل التحليل.

---

### ⚙️ إنشاء كائن DESeq2

```{r}
dds <- DESeqDataSetFromMatrix(
  countData = count_mat,   # مصفوفة العدّات بعد التصفية والتحويل
  colData   = metadata,    # ملف البيانات الوصفية بعد التنظيف
  design    = ~ tissueType # العمود الذي نريد المقارنة بناءً عليه
)
```
## 4. تشغيل التحليل التفاضلي باستخدام DESeq2

### 📘 مكونات كائن التحليل `dds`

بعد إنشائه، يحتوي الكائن `dds` على ثلاثة مكونات رئيسية:

| المكوّن | الشرح |
|----------|--------|
| **countData** | مصفوفة العدّات الجينية بعد التصفية (عدد القراءات لكل جين في كل عينة). |
| **colData** | جدول البيانات الوصفية (metadata) لكل عينة، يتضمن نوع العينة أو الحالة المرضية. |
| **design** | المعادلة التجريبية التي تُخبر DESeq2 كيف نقارن المجموعات (هنا: ~ `tissueType`). |

> 💡 هذا يعني أن خوارزمية **DESeq2** ستبحث عن الجينات التي يختلف مستوى تعبيرها باختلاف نوع النسيج  
> (مثل: *Primary tumor* مقابل *Solid tissue normal*).

---

### 🧠 خلف الكواليس: كيف يعمل DESeq2 إحصائيًا؟

لكل جين على حدة، يقوم **DESeq2** بتنفيذ سلسلة من الخطوات الرياضية والإحصائية الدقيقة:

1. **النموذج الإحصائي المستخدم:**  
   كل جين يُحلّل باستخدام نموذج من نوع **Negative Binomial**،  
   وهو مثالي للتعامل مع بيانات العدّات التي لا تتبع التوزيع الطبيعي.

2. **تقدير عامل الحجم (Size Factor):**  
   يُحسب عامل تطبيع لكل عينة لتصحيح الفروقات في عمق القراءة (**Library size**).  
   فمثلاً، إذا كانت عينة تمتلك ضعف عدد القراءات مقارنة بأخرى،  
   يتم تعديل ذلك قبل المقارنة حتى لا يُحسب كتعبير جيني فعلي.

3. **تقدير التشتت (Dispersion):**  
   يقدّر البرنامج مدى تباين العدّات داخل كل مجموعة (مثلاً، بين العينات الورمية).  
   هذا التشتت يُستخدم لتحديد مدى ثقة النموذج بالفرق المرصود.

4. **الاختبار الإحصائي (Wald Test):**  
   بعد التطبيع، يتم تطبيق اختبار **Wald** لكل جين لاختبار الفرضية الصفرية:  
   > H₀: لا يوجد فرق في التعبير بين المجموعتين.

5. **تصحيح القيم الاحتمالية (p-value):**  
   يتم تصحيح القيم الاحتمالية المتعددة باستخدام طريقة **FDR (Benjamini–Hochberg)**  
   لإنتاج العمود **padj** الذي يمثل الدلالة الإحصائية المصححة.

---

### ✨ النتيجة النهائية من التحليل

لكل جين، نحصل على مجموعة من القيم الأساسية:

| العمود | الشرح |
|--------|--------|
| **baseMean** | متوسط العدّات المعدّلة بعد التطبيع عبر جميع العينات. |
| **log2FoldChange** | حجم التغير في التعبير بين المجموعتين على مقياس لوغاريتمي (زيادة 1 = تضاعف مرتين). |
| **lfcSE** | الخطأ المعياري لتقدير الفرق في التعبير. |
| **stat** | قيمة اختبار Wald الإحصائية. |
| **pvalue** | القيمة الاحتمالية الأولية. |
| **padj** | القيمة الاحتمالية بعد التصحيح (FDR). |

---

### ⚙️ تشغيل التحليل التفاضلي

الآن نشغّل خوارزمية التحليل على كائن `dds`.  
ستقوم هذه الدالة تلقائيًا بتنفيذ جميع المراحل السابقة:

```{r}
dds <- DESeq(dds)
```

### 📊 قراءة النتائج:

بعد تنفيذ هذا السطر، أصبح لدينا نموذج كامل جاهز لاستخراج النتائج.
يمكنك طباعة الكائن dds لرؤية معلومات عن عدد الجينات والعينات والخصائص:
```{r}
dds
```

## 5. استخراج نتائج المقارنة

### 📑 الهدف من هذه الخطوة

بعد أن شغّلنا نموذج **DESeq2** على البيانات،  
حان الوقت لاستخراج النتائج الخاصة بالمقارنة التي نهتم بها.

في هذه الورشة، نريد مقارنة التعبير الجيني بين:

> 🧬 **Primary tumor 🆚 Solid tissue normal**

---

### ⚙️ استخراج النتائج

```{r}
res <- results(
  dds,
  contrast = c("tissueType", "primary_tumor", "normal")
)
```

### 💡 ما معنى الـ contrast؟

القيمة الأولى `"tissueType"` هي اسم العمود الذي نقارن بناءً عليه.  
ثم نحدد المجموعتين للمقارنة:

- `"primary_tumor"` → المجموعة التجريبية.  
- `"normal"` → المجموعة المرجعية (baseline).  

---

### 📘 تفسير الأعمدة في ناتج DESeq2

| العمود | الشرح |
|--------|--------|
| **baseMean** | المتوسط المعدّل للعدّات عبر جميع العينات بعد التطبيع. |
| **log2FoldChange** | الفرق في التعبير الجيني بين المجموعتين على مقياس لوغاريتمي (الزيادة بمقدار 1 = تضاعف مرتين). |
| **lfcSE** | الخطأ المعياري لتقدير الـ log2FC. |
| **stat** | إحصائية اختبار Wald المستخدمة لاختبار الفرضية. |
| **pvalue** | القيمة الاحتمالية قبل التصحيح. |
| **padj** | القيمة الاحتمالية بعد التصحيح المتعدد (**FDR**). |

---

### 📊 قراءة النتائج

```{r}
head(res)
```

يمكننا ترتيب النتائج لاحقًا حسب الأهمية الإحصائية،  
حيث تمثل القيم الأقل في **padj** الجينات الأكثر دلالة في الفروق.

---

## 📘 ملخص هذه المرحلة

✨ في هذه المرحلة قمنا بـ:

- تصفية الجينات منخفضة التعبير لتقليل الضجيج.  
- إنشاء كائن التحليل وتجهيزه باستخدام **DESeq2**.  
- تشغيل التحليل الإحصائي الكامل.  
- استخراج نتائج المقارنة بين الورم الأولي والنسيج الطبيعي.  
- فهم أعمدة النتائج وكيفية تفسيرها.  

> 💡 النتيجة: أصبح لدينا جدول نهائي للجينات مع قيم دقيقة للفروق في التعبير الجيني،  
> وسنبدأ الآن في تحويل البيانات بصريًا لتمكين التحليلات الرسومية القادمة مثل PCA وVolcano وBoxplot وViolin.

---

## 🔄 تحويل البيانات بصريًا (VST Transformation)

### 💡 الهدف من هذه الخطوة

في بيانات الـ RNA-seq الخام (العدّات **counts**)  
يزداد التباين مع زيادة المتوسط،  
مما يجعل الرسوم مثل **PCA** أو **Heatmap** غير دقيقة —  
حيث تهيمن الجينات ذات القراءات العالية على معظم التباين.

لحل هذه المشكلة نستخدم التحويل المسمى:

> **Variance Stabilizing Transformation (VST)**  

وهو يحوّل القيم بحيث يصبح التباين أكثر تجانسًا بين الجينات،  
أي أن الجينات ذات التعبير العالي والمنخفض تُقارن على نفس المقياس تقريبًا.

---

```{r}
vsd <- vst(dds, blind = FALSE)
```

> 💡 تعني المعلمة `blind = FALSE` أننا نأخذ في الاعتبار **التصميم التجريبي (experimental design)** أثناء التحويل،  
> أي أن التحويل يتم بطريقة تراعي الفروق بين المجموعات،  
> مما يجعله أكثر ملاءمة لعمليات التصور **بعد التحليل التفاضلي**.

---

### 📊 قراءة النتائج

بعد تنفيذ التحويل، أصبح لدينا كائن جديد يسمى **vsd**  
يحمل القيم المحوّلة باستخدام VST بدلاً من العدّات الخام.

يمكننا استعراض جزء من البيانات المحوّلة لملاحظة شكلها الجديد:

```{r}
assay(vsd)[1:5, 1:5]
```

ستلاحظ أن القيم أصبحت **عشرية** وليست عدّات صحيحة،  
وهذا طبيعي لأن التحويل **كسر العلاقة الأصلية بين التباين والمتوسط**،  
مما يجعل الجينات ذات التعبير المنخفض والعالي قابلة للمقارنة على نفس المقياس.

---

## 📘 لماذا نستخدم VST بدل log2(count + 1)؟

التحويل اللوغاريتمي البسيط `log2(count + 1)`  
يُخفف فقط من الفروق الكبيرة لكنه **لا يُصحّح التباين بشكل كافٍ**،  
خصوصًا للجينات منخفضة التعبير.

بينما يقوم **VST** بتقدير العلاقة بين التباين والمتوسط من البيانات نفسها،  
ويُطبّق تصحيحًا أكثر دقة يجعل التوزيع أكثر تجانسًا —  
مما يُحسّن دقة الرسوم الإحصائية مثل **PCA** و **Heatmap**.

---

## 📊 تحليل المكونات الرئيسية (PCA)

### 💡 الهدف من هذه الخطوة

يساعد تحليل **المكونات الرئيسية (Principal Component Analysis)** على:

- تبسيط البيانات عالية الأبعاد (آلاف الجينات).  
- رؤية **أنماط التجمّع بين العينات**.  
- اكتشاف **العينات الشاذة (Outliers)**.  
- تقييم مدى التشابه بين الحالات التجريبية (مثل الورم مقابل الطبيعي).

---

```{r}
# إجراء PCA على القيم المحوّلة (VST)
pca <- prcomp(t(assay(vsd)), center = TRUE, scale. = FALSE)

# حساب نسبة التباين المفسَّر في أول مكونين
percentVar <- round(100 * (pca$sdev^2 / sum(pca$sdev^2))[1:2], 1)

# تجهيز البيانات الخاصة بالرسم
pca_df <- data.frame(
  PC1 = pca$x[, 1],
  PC2 = pca$x[, 2],
  sample = colnames(vsd),
  tissueType = colData(vsd)$tissueType
)

head(pca_df)
```

## 📈 رسم مخطط PCA

بعد حساب مكونات PCA،  
سنقوم الآن برسمها لعرض **تجمّع العينات** بناءً على تشابهها في أنماط التعبير الجيني.

```{r}
# إنشاء رسم PCA بسيط لتوضيح توزيع العينات بعد التحويل (VST)
ggplot(pca_df, aes(PC1, PC2, color = tissueType)) +
  geom_point(size = 3) +  # رسم النقاط التي تمثل العينات
  labs(
    title = "PCA of Samples after VST Transformation",  # عنوان الرسم
    x = paste0("PC1 (", percentVar[1], "%)"),           # تسمية المحور السيني
    y = paste0("PC2 (", percentVar[2], "%)")            # تسمية المحور الصادي
  ) +
  theme_minimal()  # استخدام تنسيق بسيط وواضح
```
## 📘 قراءة النتائج من تحليل PCA

- كل نقطة تمثل **عينة واحدة**.  
- قرب العينات من بعضها يعني **تشابه أنماط التعبير الجيني** بينها.  
- التجمّع الواضح لكل حالة يدل على **اختلاف بيولوجي حقيقي** بين المجموعات.  
- أي نقطة بعيدة جدًا (خارج التجمع) قد تشير إلى **عينة شاذة (Outlier)**.

---

### 🧠 خلف الكواليس

يقوم تحليل **PCA** بتحويل آلاف الأبعاد (عدد الجينات) إلى عدد قليل من **المكونات الرئيسية (Principal Components)**  
التي تُلخص أكبر قدر من التباين في البيانات:

- **PC1** يمثل أكبر مصدر للتباين في البيانات.  
- **PC2** يمثل ثاني أكبر مصدر للتباين.  

> عادةً في بيانات **RNA-seq**، هذه المكونات تعكس إما **الاختلاف البيولوجي الحقيقي** بين الحالات  
> أو **عوامل تقنية** مثل عمق القراءة (Library Size).

---

## 🌋 رسم Volcano Plot

### 💡 الهدف من هذه الخطوة

يُستخدم **مخطط Volcano plot** لعرض نتائج التحليل التفاضلي بطريقة تجمع بين:

- **حجم التأثير** (log2FoldChange) على المحور السيني.  
- **الأهمية الإحصائية** (-log10(padj)) على المحور الصادي.

> كلما صعدت النقطة للأعلى ⬆️ → زادت أهميتها الإحصائية.  
> كلما ابتعدت يمينًا أو يسارًا ⬅️➡️ → كان الفرق في التعبير أكبر.

---

```{r}
res_df <- as.data.frame(res) %>%
  rownames_to_column("gene_id") %>%                  # نقل أسماء الجينات إلى عمود جديد
  mutate(
    padj = if_else(is.na(padj), 1.0, padj),          # تعويض القيم المفقودة في padj
    neg_log10_padj = -log10(padj),                   # حساب -log10(padj) للرسم
    significance = case_when(                        # تحديد حالة كل جين
      padj < 0.05 & log2FoldChange > 1  ~ "Upregulated",
      padj < 0.05 & log2FoldChange < -1 ~ "Downregulated",
      TRUE                              ~ "Not significant"
    )
  )

head(res_df)
```

## 📊 رسم مخطط Volcano Plot

بعد تجهيز إطار البيانات (**res_df**)  
سنرسم الآن **مخطط البركان (Volcano Plot)** الذي يُظهر الجينات المتغيرة في التعبير بين المجموعتين.

```{r}
# إنشاء Volcano Plot لعرض الجينات حسب حجم التأثير والدلالة الإحصائية
ggplot(res_df, aes(x = log2FoldChange, y = neg_log10_padj, color = significance)) +
  geom_point(alpha = 0.75, size = 1.8) +  # رسم النقاط (كل نقطة = جين)
  scale_color_manual(values = c(           # تحديد ألوان المجموعات
    "Upregulated" = "#E74C3C",             # أحمر = معبَّر أكثر في الورم
    "Downregulated" = "#3498DB",           # أزرق = منخفض في الورم
    "Not significant" = "grey70"           # رمادي = غير معنوي
  )) +
  geom_vline(xintercept = c(-1, 1), linetype = "dashed", color = "black") +   # خطوط تحدد ±1 في log2FC
  geom_hline(yintercept = -log10(0.05), linetype = "dashed", color = "black") + # خط للدلالة الإحصائية
  labs(
    title = "Volcano Plot: Primary tumor vs Solid tissue normal",  # عنوان الرسم
    x = "Log2 Fold Change",                                        # تسمية المحور السيني
    y = "-Log10(FDR)",                                             # تسمية المحور الصادي
    color = "Status"                                               # وسيلة الإيضاح 
  ) +
  theme_minimal(base_size = 14)  # تنسيق بسيط وواضح
```

## 📦 عرض الجينات الأكثر تفاضلاً (Boxplot & Violin)

### 💡 الهدف من هذه الخطوة

بعد تحديد الجينات الأكثر اختلافًا في التعبير،  
سنقوم الآن بعرض **أنماط التعبير** لتلك الجينات عبر المجموعتين (الورم والنسيج الطبيعي).  
سنختار **أعلى 10 جينات تفاضلاً** (أي أقل قيمة padj) لعرضها بصريًا.

```{r}
top10 <- res_df %>%
  filter(!is.na(padj)) %>%        # إزالة القيم المفقودة من العمود padj
  arrange(padj) %>%               # ترتيب الجينات حسب القيمة الإحصائية
  slice_head(n = 10) %>%          # اختيار أول 10 جينات فقط
  pull(gene_id)                   # استخراج أسماء الجينات

norm_counts <- counts(dds, normalized = TRUE)  # الحصول على العدّات بعد التطبيع

plot_df <- as.data.frame(norm_counts[top10, , drop = FALSE]) %>%  # تحديد الجينات العشرة الأعلى
  rownames_to_column("gene_id") %>%                               # تحويل أسماء الجينات إلى عمود
  pivot_longer(-gene_id, names_to = "sample", values_to = "count") %>%  # تحويل الجدول إلى صيغة طويلة (long format)
  left_join(                                                      # ربط البيانات الوصفية الخاصة بالعينات
    as.data.frame(colData(dds)) %>% 
      rownames_to_column("sample") %>%
      select(sample, tissueType),
    by = "sample"
  )

head(plot_df)
```

### 📊 Boxplot للجينات العشرة الأعلى تفاضلًا

الآن سنعرض توزيع قيم التعبير الجيني للجينات العشرة الأعلى تفاضلًا  
باستخدام **Boxplot** الذي يُظهر القيم المتوسطة والانحرافات داخل كل مجموعة.

```{r}
# تصفية المجموعتين المطلوبتين فقط + عمل تحويل لوغاريتمي مسبقًا لتجنّب تحذير التحويل
plot_df2 <- plot_df %>%
  dplyr::filter(tissueType %in% c("normal", "primary_tumor")) %>%         # إبقاء normal و primary_tumor فقط
  dplyr::mutate(
    tissueType = factor(tissueType, levels = c("normal", "primary_tumor")),# ترتيب ثابت للمجموعتين
    log_count = log10(count + 1)                                           # تحويل لوغاريتمي مسبقًا لتفادي قيم ∞
  )

# رسم واحد يدمج Boxplot + نقاط + (بسيط وواضح بالألوان الافتراضية)
ggplot(plot_df2, aes(x = gene_id, y = log_count, fill = tissueType)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.8,                           # Boxplot بدون نقاط خارجية
               position = position_dodge(width = 0.75)) +                 # فصل المجموعتين لكل جين
  geom_jitter(aes(color = tissueType),                                    # نقاط كل عينة فوق البوكس
              position = position_jitterdodge(jitter.width = 0.2, 
                                              dodge.width  = 0.75),
              size = 1, alpha = 0.5) +
  labs(
    title = "Top 10 DE Genes (Normal vs Primary Tumor)",                  # عنوان الرسم
    x = "Gene",                                                           # المحور السيني (أسماء الجينات)
    y = "log10(Normalized Counts + 1)",                                   # المحور الصادي (بعد التحويل)
    fill  = "Tissue Type",                                                # وسيلة الإيضاح (للأعمدة)
    color = "Tissue Type"                                                 # وسيلة الإيضاح (للنقاط)
  ) +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))                # تدوير أسماء الجينات لسهولة القراءة

```

### 🎻 Violin Plot للجينات نفسها  

يوضح **Violin Plot** توزيع قيم التعبير الجيني بشكل أكثر تفصيلًا،  
حيث يجمع بين شكل الكثافة (Distribution) وصندوق القيم (Boxplot)،  
مما يسمح بمقارنة شكل توزيع القيم داخل كل مجموعة (ورم أولي مقابل نسيج طبيعي).

```{r}

# تصفية المجموعتين + التحويل اللوغاريتمي مسبقًا
plot_df2 <- plot_df %>%
  dplyr::filter(tissueType %in% c("normal", "primary_tumor")) %>%         # إبقاء المجموعتين فقط
  dplyr::mutate(
    tissueType = factor(tissueType, levels = c("normal", "primary_tumor")), # ترتيب المجموعتين
    log_count = log10(count + 1)                                            # تحويل لوغاريتمي مسبقًا
  )

# رسم Violin بسيط وواضح
ggplot(plot_df2, aes(x = gene_id, y = log_count, fill = tissueType)) +
  geom_violin(trim = FALSE, alpha = 0.7, position = position_dodge(width = 0.75)) + # شكل الكثافة لكل مجموعة
  geom_jitter(aes(color = tissueType),                                              # نقاط العينات فوق المنحنى
              position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75),
              size = 1, alpha = 0.5) +
  labs(
    title = "Top 10 DE Genes (Violin Plot: Normal vs Primary Tumor)",      # عنوان الرسم
    x = "Gene",                                                            # المحور السيني (أسماء الجينات)
    y = "log10(Normalized Counts + 1)",                                    # المحور الصادي بعد التحويل
    fill  = "Tissue Type",                                                 # وسيلة الإيضاح (للأعمدة)
    color = "Tissue Type"                                                  # وسيلة الإيضاح (للنقاط)
  ) +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))                 # تدوير أسماء الجينات لسهولة القراءة

```

## 📊 قراءة النتائج  

- كل **صندوق أو شكل كمان (Violin)** يمثل توزيع قيم التعبير لجين معيّن داخل كل مجموعة من العينات.  
- إذا كانت مجموعة **Primary tumor** تمتلك قيمًا أعلى بوضوح، فهذا يعني أن هذا الجين **مرتفع التعبير في الورم**.  
- استخدام **المقياس اللوغاريتمي** يجعل الفروق الصغيرة بين القيم أكثر وضوحًا بصريًا.  

---

## 📘 ملخص هذه المرحلة  

✨ في هذه المرحلة قمنا بـ:  

1️⃣ **تحويل البيانات** لتصحيح التباين (VST).  
2️⃣ **تحليل العلاقات** بين العينات عبر PCA.  
3️⃣ **عرض الجينات التفاضلية** عبر Volcano plot.  
4️⃣ **دراسة الجينات المهمة** عبر Boxplot وViolin plot.  

> ✅ النتيجة: أصبح لدينا **فهم بصري شامل للفروق** بين العينات والجينات.  
> سننتقل الآن إلى المرحلة التالية: **تحليل الإثراء الوظيفي (GO وKEGG)** لفهم الوظائف والمسارات المتأثرة بهذه الجينات التفاضلية.  

---

# 🧭 تحليل الإثراء الوظيفي (GO & KEGG)

بعد أن تعرفنا على الجينات المتغايرة في التعبير، ننتقل الآن للسؤال الأهم:  
🧠 *ما هي الوظائف الحيوية والمسارات التي تتأثر بهذه الجينات؟*  

---

## 💡 مقدمة عن تحليل الإثراء  

بعد أن نحصل على قائمة الجينات التي أظهرت فروقًا معنوية في التعبير،  
نحتاج أن نفهم **المغزى البيولوجي** وراء هذه الجينات.  
هل ترتبط بوظائف معينة؟ هل تشارك في مسارات أيضية أو إشارية محددة؟  

تحليل الإثراء (**Functional Enrichment Analysis**) هو ما يجيب عن هذا السؤال.  

---

## 💡 كيف نقرأ نتائج GO وKEGG وما الفرق بينهما؟  

| القاعدة | المعنى | الغرض |
|----------|---------|--------|
| **Gene Ontology (GO)** | تصنيف شامل للوظائف الجينية. ينقسم إلى ثلاث فئات: 1️⃣ Biological Process (BP) — العمليات الحيوية، 2️⃣ Molecular Function (MF) — الوظائف الجزيئية، 3️⃣ Cellular Component (CC) — المواقع الخلوية. | يصف "ما الذي يفعله الجين وأين ولماذا". |
| **KEGG Pathways** | قاعدة بيانات للمسارات الأيضية والإشارية المعروفة. كل مسار يضم مجموعة من الجينات المتفاعلة. | يوضح "كيف تعمل الجينات معًا ضمن شبكة واحدة". |

> ✨ الفرق الأساسي:  
> **GO** تصف *الوظائف الفردية للجينات*.  
> **KEGG** تصف *العلاقات والمسارات المشتركة بين الجينات*.  

---

## 🧩 الخطوة الأولى: اختيار الجينات المهمة  

```{r select-sig}
sig_genes <- res_df %>%
  filter(padj < 0.05, abs(log2FoldChange) > 1) %>%        # اختيار الجينات ذات دلالة إحصائية وفروق واضحة
  mutate(gene_id = str_replace(gene_id, "\\.\\d+$", "")) %>%  # إزالة النسخ الثانوية من معرفات Ensembl
  pull(gene_id)                                            # استخراج أسماء الجينات فقط

length(sig_genes)                                          # عرض عدد الجينات المهمة
```

💡 في هذه الخطوة نختار الجينات التي تمتلك **دلالة إحصائية قوية**  
(`padj < 0.05`) وفروقًا واضحة في مستوى التعبير (`|log2FC| > 1`).  

---

## 🧬 تحويل معرفات الجينات إلى ENTREZ  

تحليل الإثراء باستخدام مكتبة **clusterProfiler** يعتمد على معرفات  
**Entrez Gene IDs** وليس **Ensembl IDs**،  
لذلك يجب تحويل المعرفات أولًا باستخدام قاعدة البيانات **org.Hs.eg.db** الخاصة بالإنسان.

```{r}
entrez_ids <- AnnotationDbi::mapIds(
  org.Hs.eg.db,               # قاعدة بيانات الجينات البشرية
  keys = sig_genes,            # قائمة الجينات المختارة من نتائج DESeq2
  column = "ENTREZID",         # نوع المعرف المطلوب الحصول عليه
  keytype = "ENSEMBL",         # نوع المعرف الحالي المستخدم في القائمة
  multiVals = "first"          # إذا وُجد أكثر من Entrez ID للجين، نأخذ الأول فقط
)

entrez_ids <- na.omit(entrez_ids)  # إزالة أي قيم مفقودة (جينات بدون معرف Entrez)
length(entrez_ids)                 # عرض عدد الجينات التي تم تحويلها بنجاح
```

## ⚙️ تنفيذ تحليل GO (Biological Process)

الآن بعد أن أصبح لدينا معرفات الجينات بصيغة **ENTREZ IDs**،  
سنقوم بتنفيذ **تحليل الإثراء الوظيفي (GO Enrichment Analysis)**  
باستخدام مكتبة **clusterProfiler** لتحديد العمليات الحيوية (Biological Processes)  
التي تحتوي على عدد كبير من الجينات المتغيرة في التعبير.

```{r}
ego <- enrichGO(
  gene = entrez_ids,           # قائمة الجينات المهمة بصيغة Entrez IDs
  OrgDb = org.Hs.eg.db,        # قاعدة بيانات الجينات الخاصة بالإنسان
  keyType = "ENTREZID",        # نوع المعرّف المستخدم
  ont = "BP",                  # نوع تصنيف GO: Biological Process
  pvalueCutoff = 0.05,         # الحد الأقصى للقيمة الاحتمالية قبل اعتبار النتيجة مهمة
  pAdjustMethod = "BH",        # طريقة تصحيح القيم الاحتمالية (Benjamini-Hochberg)
  readable = TRUE              # تحويل المعرفات إلى أسماء جينات مفهومة للقراءة
)

go_df <- as.data.frame(ego)    # تحويل نتائج GO إلى إطار بيانات لسهولة المعالجة
head(go_df)                    # عرض أول 6 صفوف من النتائج
```

## 📊 رسم نتائج GO – Barplot  

الآن سنقوم برسم **أهم العمليات الحيوية (GO terms)**  
التي أظهرت إثراءً معنويًا في مجموعة الجينات المتغايرة في التعبير.  
يمثل هذا الرسم عدد الجينات المشاركة في كل عملية حيوية (Count)،  
ويُلوَّن حسب درجة الأهمية الإحصائية (**p.adjust**).

```{r}
# رسم أهم العمليات الحيوية (GO terms) الغنية بالجينات المتغايرة
barplot(
  ego,                          # كائن الإثراء الناتج من enrichGO()
  showCategory = 15,            # عرض أعلى 15 عملية حيوية فقط
  title = "GO Enrichment (Biological Process)",  # عنوان الشكل
  font.size = 12,               # حجم الخطوط داخل الرسم
  xlab = "Number of Genes",     # تسمية المحور السيني 
  color = "p.adjust"            # تلوين الأعمدة حسب القيمة المعدلة p.adjust
)                   # تطبيق تنسيق بسيط وواضح
```

## 📈 رسم نتائج GO – Dotplot  

يوضّح **Dotplot** نتائج تحليل GO بطريقة تجمع بين  
عدد الجينات المشاركة (**Count**) ونسبة الجينات ضمن كل عملية (**GeneRatio**)  
مع تلوين النقاط بحسب مستوى الدلالة الإحصائية (**p.adjust**).  
كل نقطة تمثل عملية حيوية (Biological Process).

```{r}
# رسم Dotplot لأهم العمليات الحيوية (GO terms)
dotplot(
  ego,                           # كائن الإثراء الناتج من enrichGO()
  showCategory = 15,             # عرض أعلى 15 عملية حيوية
  title = "GO Enrichment (Biological Process)",  # عنوان الرسم
  font.size = 12
)               
```
## 📊 قراءة النتائج  

- كل صف في الجدول يمثل **عملية حيوية (Biological Process)** تحتوي على عدد كبير من الجينات المتغيرة في التعبير.  
- كلما **زاد عدد الجينات (Count)** و**انخفضت قيمة p.adjust**، زادت أهمية هذه العملية الحيوية.  
- النقاط الكبيرة في الرسم (Dotplot) تمثل عمليات تشمل عددًا أكبر من الجينات المتأثرة.  

---

## ⚙️ تنفيذ تحليل KEGG Pathway  

الآن سننفّذ تحليل **KEGG Pathway Enrichment**  
لتحديد المسارات الأيضية أو الإشارية التي تتأثر بالجينات المتغيرة في التعبير.  
يُظهر هذا التحليل كيف تتفاعل الجينات معًا ضمن شبكات بيولوجية أوسع.

```{r}
ereact <- enrichPathway(
  gene = entrez_ids,
  organism = "human",
  pvalueCutoff = 0.05,
  readable = TRUE
)

kegg_df <- as.data.frame(ereact) # تحويل النتائج إلى إطار بيانات
head(kegg_df)                   # عرض أول 6 صفوف من نتائج KEGG
```

## 📊 رسم نتائج KEGG  

يُظهر هذا الرسم **أهم المسارات الأيضية أو الإشارية (Pathways)**  
التي تضم عددًا كبيرًا من الجينات المتغيرة في التعبير الجيني.  
يتم ترتيب المسارات حسب عدد الجينات المشاركة فيها (**Count**)  
مع تدرّج لوني يعبّر عن **مستوى الدلالة الإحصائية (p.adjust)**.

```{r}
# Barplot: عرض أهم المسارات الأيضية/الإشارية حسب عدد الجينات
barplot(ereact, 
        showCategory = 15,                 # عرض أعلى 15 مسارًا فقط
        title = "KEGG Pathway Enrichment", # عنوان الرسم
        font.size = 12)                    # حجم النصوص
```

```{r}
# Dotplot: عرض المسارات مع توضيح نسبة الجينات والدلالة الإحصائية
dotplot(ereact, 
        showCategory = 15,                 # عرض أعلى 15 مسارًا
        title = "KEGG Pathway Enrichment (Dotplot)", 
        font.size = 12)
```


## 📊 قراءة النتائج  

- يمثل كل صف في جدول **KEGG** مسارًا أيضيًا أو إشارياً يحتوي على عدد من الجينات المتغايرة في التعبير.  
- انخفاض قيمة **p.adjust** يشير إلى أن هذا المسار أكثر احتمالًا أن يكون مرتبطًا بالمرض أو الظاهرة قيد الدراسة.  
- أمثلة شائعة قد تظهر في مثل هذه التحليلات:  
  *Cell cycle*, *p53 signaling*, *Metabolic pathways*.

---

## 📘 ملخص هذه المرحلة  

✨ في هذا الجزء تعلمنا:

| المرحلة | ما تعلمناه | الأدوات المستخدمة |
|----------|-------------|--------------------|
| **تحويل المعرفات** | كيفية تحويل الجينات المهمة إلى معرفات Entrez صالحة للتحليل | `AnnotationDbi` |
| **تحليل الإثراء** | تنفيذ تحليلي **GO** و **KEGG** لفهم المعاني البيولوجية للجينات المتغايرة | `clusterProfiler` |
| **التصور البياني** | عرض النتائج بطريقة تفاعلية وواضحة باستخدام **ggplot2** | `ggplot2` |

---

# 📘 خاتمة الورشة  

## 💡 ملخص ما تعلمناه خلال اليوم  

| المرحلة | ما تعلمناه | الأدوات المستخدمة |
|----------|-------------|--------------------|
| **قراءة البيانات** | فهم ملفات العدّات (**counts**) وملف التصميم (**metadata**) وربطهما معًا | tidyverse |
| **تصفية الجينات** | إزالة الجينات منخفضة التعبير لتقليل الضجيج وتحسين دقة التحليل | base R |
| **التحليل التفاضلي** | مقارنة المجموعات باستخدام نموذج **DESeq2** | DESeq2 |
| **التصور البياني** | تحليل **PCA** و **Volcano** و **Box/Violin plots** | ggplot2 |
| **الإثراء الوظيفي** | تحليل **GO** و **KEGG** لتفسير الوظائف والمسارات الحيوية المتأثرة | clusterProfiler |
| **التطوير الإضافي** | التحليلات المتقدمة مثل **Heatmap**، تصحيح **Batch Effect**، وتحليل **GSEA** | pheatmap, limma |

---

# 🧪 التطبيقات العملية  

في نهاية الورشة، يُطلب من المشاركين تطبيق ما تعلموه عمليًا  
على مقارنة جديدة بين:  
> **Primary tumor 🆚 Metastatic liver tissue**

الهدف من هذه التمارين هو **تعزيز الفهم التطبيقي** لكل خطوة تم تنفيذها في الورشة.  
يمكن لكل مجموعة اختيار **أحد المهام التالية** وإنجازها خلال الجلسة العملية:

---

### 🧭 المهام المقترحة  

1️⃣ **إسقاط العينة الشاذة وإعادة رسم الـ PCA**  
- حدد العينة الخارجة عن التجمع العام (Outlier) في مخطط PCA.  
- استبعدها وأعد رسم الـ PCA باستخدام البيانات المتبقية.  
- ناقش كيف تغيّر توزيع العينات بعد الإزالة.  

---

2️⃣ **رسم Volcano Plot للمقارنة الجديدة**  
- استخدم نفس خطوات التحليل التفاضلي لكن للمقارنة:  
  `Metastatic liver tissue` مقابل `Primary tumor`.  
- ارسم Volcano Plot جديدًا وفسّر الجينات الأكثر تغيّرًا.  

---

3️⃣ **رسم Boxplot لأكثر 10 جينات تفاضلًا**  
- اختر أعلى 10 جينات ذات أقل قيمة `padj`.  
- ارسم Boxplot للتعبير الجيني لتلك الجينات بين المجموعتين.  
- استخدم مقياس `log10` للمحور العمودي لتسهيل المقارنة.  

---

4️⃣ **تنفيذ تحليل GO (لجينات Upregulated فقط)**  
- استخرج الجينات التي **padj < 0.05** و**log2FC > 1**.  
- نفّذ تحليل GO عليها فقط باستخدام `enrichGO()`.  
- اعرض النتائج في **Barplot** وناقش أهم العمليات الحيوية المتأثرة.  

---

5️⃣ **تنفيذ تحليل KEGG ومقارنة أهم 5 مسارات**  
- نفّذ تحليل `enrichKEGG()` لنفس الجينات السابقة.  
- قارن بين **أهم 5 مسارات** من KEGG ونتائج GO السابقة.  
- هل المسارات تتفق في الاتجاه البيولوجي؟  

---

# 📚 مصادر إضافية للقراءة  

| المصدر | الوصف |
|---------|--------|
| 📗 [DESeq2 documentation](https://bioconductor.org/packages/release/bioc/html/DESeq2.html) | دليل استخدام مكتبة DESeq2 الرسمية |
| 📘 [clusterProfiler manual](https://yulab-smu.top/biomedical-knowledge-mining-book/) | شرح مفصل لتحليل GO وKEGG |
| 📙 [RNA-seq analysis guide](https://hbctraining.github.io/DGE_workshop/) | دورة تدريبية مفتوحة في تحليل RNA-seq |
| 📓 [Introduction to ggplot2](https://ggplot2.tidyverse.org/) | مرجع لتخصيص الرسومات باستخدام ggplot2 |

---

# ✨ ختام الورشة  

🎉 **انتهت ورشة اليوم بنجاح!**  

في هذه الورشة تعلّمنا كيف ننتقل من **بيانات العدّات الخام**  
إلى **تفسير بيولوجي متكامل** يوضح معنى التغيّرات في التعبير الجيني.  

> 💡 فهمك لكل خطوة — من التنظيف إلى التحليل الإحصائي ثم التفسير —  
> هو ما يجعلك قادرًا على تنفيذ تحليلات RNA-seq بثقة واحترافية.

نتمنى أن تكون هذه التجربة قد أضافت لك معرفة عملية واضحة  
وأن تساعدك على تحليل بياناتك البحثية القادمة بسهولة أكبر.
